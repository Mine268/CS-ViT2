# å¿«é€Ÿå¼€å§‹ - æ¸è¿›å¼Dropoutè®­ç»ƒ

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### é—®é¢˜
åŸè®­ç»ƒé…ç½®åœ¨æ—©æœŸé˜¶æ®µè¿‡æ‹ŸåˆåŠ å‰§ï¼ŒéªŒè¯æ³¢åŠ¨å¤§

### è§£å†³æ–¹æ¡ˆ
1. **æ¸è¿›å¼Dropout**: è®­ç»ƒå‰10000æ­¥ç¦ç”¨dropoutï¼ŒåæœŸå¯ç”¨æå‡æ³›åŒ–
2. **éªŒè¯é›†å›ºå®šseed**: ç¡®ä¿æ¯æ¬¡éªŒè¯ä½¿ç”¨ç›¸åŒæ•°æ®ï¼Œä¾¿äºå¯¹æ¯”

## ğŸš€ ç«‹å³å¼€å§‹

### 1. éªŒè¯ä»£ç æ­£ç¡®æ€§
```bash
python -m tests.test_progressive_dropout
```

**é¢„æœŸè¾“å‡º**:
- âœ… Dropoutè®¡ç®—å‡½æ•°æµ‹è¯•é€šè¿‡
- âœ… æ¨¡å‹æ¥å£æµ‹è¯•é€šè¿‡
- âœ… æ‰€æœ‰Dropoutå±‚æ­£ç¡®æ›´æ–°

### 2. å¯åŠ¨è®­ç»ƒ
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰
python script/stage1.py --config-name=stage1-dino_large

# æˆ–è‡ªå®šä¹‰å‚æ•°
python script/stage1.py --config-name=stage1-dino_large \
    GENERAL.dropout_warmup_step=8000 \
    MODEL.handec.dropout=0.15
```

### 3. ç›‘æ§è®­ç»ƒ

**æ—¥å¿—è¾“å‡º**:
```
3000/100000 lr=1.0000e-04 dropout=0.000 total=1.15 loss_theta=0.08 ...
                              â†‘ dropoutç‡ç›‘æ§
```

**AIM Dashboard**:
- æŸ¥çœ‹ `dropout_rate` æ›²çº¿
- å¯¹æ¯”è®­ç»ƒloss vs éªŒè¯loss
- å…³æ³¨éªŒè¯MPJPEæ³¢åŠ¨

## ğŸ“‹ å…³é”®é…ç½®

### config/stage1-dino_large.yaml
```yaml
GENERAL:
  dropout_warmup_step: 10000  # Dropouté¢„çƒ­æ­¥æ•°
  val_seed: 42                # éªŒè¯é›†å›ºå®šseed

MODEL:
  handec:
    dropout: 0.1              # ç›®æ ‡dropoutç‡
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### è®­ç»ƒæ—©æœŸ (0-10000æ­¥)
- Dropout = 0.0 â†’ è®­ç»ƒlossæ›´ä½
- è¿‡æ‹Ÿåˆgapå‡å°: +57.5mm â†’ ~+45mm
- ä¼˜åŒ–æ›´ç¨³å®š

### è®­ç»ƒä¸­åæœŸ (10000+æ­¥)
- Dropout = 0.1 â†’ æ³›åŒ–æ€§æå‡
- éªŒè¯æ³¢åŠ¨å‡å°: 22.41mm â†’ <18mm
- æŒ‡æ ‡æ›´ä¸€è‡´

### æ•´ä½“æŒ‡æ ‡é¢„æœŸ
- **å¹³å‡MPJPE**: 84.47mm â†’ <80mm (-5%+)
- **æ ‡å‡†å·®**: 22.41mm â†’ <18mm (-20%+)
- **è®­ç»ƒloss**: 1.230 â†’ ~1.10 (-10%+)

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜: æµ‹è¯•å¤±è´¥
```bash
# æ£€æŸ¥ç¯å¢ƒ
python -c "import torch; import transformers; print('OK')"

# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls model/facebook/dinov2-large/
```

### é—®é¢˜: è®­ç»ƒlossä¸é™
- æ£€æŸ¥dropout_warmup_stepæ˜¯å¦è®¾ç½®æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—ä¸­çš„dropoutå€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
- ç¡®è®¤å­¦ä¹ ç‡è°ƒåº¦æ­£å¸¸

### é—®é¢˜: éªŒè¯é›†æŒ‡æ ‡ä¸ç¨³å®š
- ç¡®è®¤val_seedå·²è®¾ç½®
- æ£€æŸ¥WebDatasetè·¯å¾„æ˜¯å¦æ­£ç¡®
- å¢åŠ éªŒè¯é¢‘ç‡ä»¥è·å¾—æ›´å¤šæ•°æ®ç‚¹

## ğŸ“ é‡è¦æ–‡ä»¶

### æ–‡æ¡£
- [IMPROVEMENTS_SUMMARY.md](IMPROVEMENTS_SUMMARY.md) - è¯¦ç»†æ”¹è¿›è¯´æ˜
- [CODE_DESIGN.md](CODE_DESIGN.md) - ä»£ç è®¾è®¡æ–‡æ¡£
- [REFACTORING_SUMMARY.md](REFACTORING_SUMMARY.md) - é‡æ„æ€»ç»“

### ä»£ç 
- `../src/utils/train_utils.py` - å·¥å…·å‡½æ•°
- `../src/model/net.py` - æ¨¡å‹æ¥å£
- `../script/stage1.py` - è®­ç»ƒè„šæœ¬

### æµ‹è¯•
- `../tests/test_progressive_dropout.py` - æµ‹è¯•è„šæœ¬

## ğŸ“ ç†è®ºä¾æ®

### ä¸ºä»€ä¹ˆéœ€è¦æ¸è¿›å¼Dropout?

1. **DINOv2é¢„è®­ç»ƒ**: ç‰¹å¾å·²ç»å¾ˆé²æ£’ï¼Œæ—©æœŸä¸éœ€è¦é¢å¤–æ­£åˆ™åŒ–
2. **Fine-tuningç¨³å®šæ€§**: Dropoutå¹²æ‰°ä¼šé˜»ç¢backboneé€‚åº”æ–°ä»»åŠ¡
3. **åæœŸæ³›åŒ–**: æ•°æ®æ‹Ÿåˆç¨³å®šåï¼Œdropouté˜²æ­¢è¿‡æ‹Ÿåˆ

### Dropouté¢„çƒ­æ›²çº¿
```
Dropoutç‡
  0.10 â”¤                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚                  â”‚
  0.05 â”¤                  â”‚
       â”‚                  â”‚
  0.00 â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Step
           10000       50000
       â†‘ é¢„çƒ­æœŸ      â†‘ æ­£å¸¸è®­ç»ƒ
```

## ğŸ”— å¿«é€Ÿé“¾æ¥

- AIM Server: `aim://10.208.33.93:53800`
- Checkpointç›®å½•: `checkpoint/`
- æ•°æ®é›†: `/mnt/qnap/data/datasets/webdatasets/`

## âœ… æ£€æŸ¥æ¸…å•

è®­ç»ƒå‰:
- [ ] è¿è¡Œ`python -m tests.test_progressive_dropout`ç¡®è®¤ä»£ç æ­£ç¡®
- [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„`dropout_warmup_step`å’Œ`val_seed`
- [ ] ç¡®è®¤AIMæœåŠ¡å™¨å¯è®¿é—®
- [ ] æ¸…ç†æ—§çš„checkpointï¼ˆå¯é€‰ï¼‰

è®­ç»ƒä¸­:
- [ ] ç›‘æ§dropoutç‡å˜åŒ–
- [ ] å¯¹æ¯”è®­ç»ƒ/éªŒè¯loss
- [ ] è®°å½•å…³é”®stepçš„éªŒè¯MPJPE

è®­ç»ƒå:
- [ ] ç»˜åˆ¶è®­ç»ƒæ›²çº¿å¯¹æ¯”
- [ ] è®¡ç®—éªŒè¯æŒ‡æ ‡ç»Ÿè®¡ï¼ˆå‡å€¼ã€æ ‡å‡†å·®ï¼‰
- [ ] å¯¹æ¯”ä¿®æ”¹å‰åçš„æ•ˆæœ

---

**å‡†å¤‡å°±ç»ªï¼å¼€å§‹è®­ç»ƒ:**
```bash
python script/stage1.py --config-name=stage1-dino_large
```

**GG**
